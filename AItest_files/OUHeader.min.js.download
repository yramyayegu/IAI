define(["knockout","pubsub","notifications","CCi18n","ccConstants","navigation","ccLogger","jquery","ccNumber","/midtier/js/footable.js","/midtier/js/global.js","notifier","/midtier/js/underscore.js","/midtier/js/priceGroupCountry.js","/midtier/js/truste-oraclelib.js"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=["/midtier/css/font-awesome.min.css","/midtier/css/ou-rw.css","/midtier/css/mmenu.css","/midtier/css/style.css","/midtier/css/flags.min.css"];"use strict",p=priceGroupCountryName[0],h=h||window._;var v=function(e,n,r){if(!n||n.length<=0){if(location.href.indexOf("/cart")!==-1){console.log("Trying to refresh the cart");for(var i in e.cart().items()){var s=e.cart().items()[i];$.Topic(t.topicNames.CART_UPDATE_QUANTITY).publishWith(s.productData(),[{message:"success"}])}window.sessionStorage.removeItem("noLoggedInItems"),r();return}window.sessionStorage.removeItem("noLoggedInItems"),r();return}var o=n.splice(0,1);o=o[0],Global.addToCartReadyProduct(e,t,c,o,function(t){console.log(" Added to Cart	: "+t.ok),v(e,n,r)})},m=function(e,t,n){Global.callRest(e,{service:"products/"+t.repositoryId,reqPar:"?fields=displayName,id,repositoryId,relatedProducts&storePriceListGroupId="+e.site().selectedPriceListGroup().id},function(e){e.orderQuantity=t.orderQuantity,e.childSKUs=t.childSKUs,n(e)})},g=function(e,t,n){var r=[];for(var i in n){var s=n[i].productData(),o=n[i].catRefId,u=n[i].productId;s||(s={repositoryId:u,childSKUs:[{repositoryId:o}],need2Load:!0},r.push(h.omit(s,"need2Load"))),s.orderQuantity=n[i].quantity()||1;var a=!0;for(var f in t)if(t[f].repositoryId===u){var l=h.pluck(t[f].childSKUs,"repositoryId");l.indexOf(o)!==-1&&(a=!1,t[f].orderQuantity+=s.orderQuantity)}a&&!s.need2Load&&t.push(s)}if(!(r.length>0))return t;var c=0,p=0;for(var d in r)c++,m(e,r[d],function(e){p++,t.push(e);if(c===p)return t})};return{ouShopcartUrl:e.observable("https://education-dev.oracle.com/webreg/ShoppingCart"),linkList:e.observableArray(),WIDGET_ID:"OUHeader",cartVisible:e.observable(!1),ignoreBlur:e.observable(!1),languageLinkText:e.observable(""),mainMenuStructure:e.observable(),myFlag:e.observable(""),loggedInstatus:e.observable("false"),helloMsg:e.observable(""),loggedInUserName:e.observable(""),loadMainMenuStructure:function(e,t){var n=this,r=n.mainMenuStructure()?n.mainMenuStructure():{};t&&t==="static"?r["static"]=e:t&&t==="dynamic"&&(r.dynamic=e),n.mainMenuStructure(r),setTimeout(function(){n.loadDesignJavascript()},500)},linkReqTraining:e.observable(""),onLoad:function(t){/education\.oracle\.com/ig.test(location.href)&&(console.log=console.warn=console.info=console.debug=function(e){}),o.info("on header load cart contains "+t.cart().items().length),t.linkList.removeAll(),console.log("********** onLoad ********"),console.log(t),console.log("********** onLoad End ********");for(var n in t.links())t.linkList.push(t.links()[n]);t.cartLinkText=e.computed(function(){var e,n,i,s=t.site().selectedPriceListGroup().currency.symbol,e=t.formatPrice(t.cart().subTotal(),t.site().selectedPriceListGroup().currency.fractionalDigits);return s.match(/^[0-9a-zA-Z]+$/)&&(s+=" "),i=t.ccNumber(t.cart().numberOfItems()),n=r.t("ns.common:resources.cartDropDownText",{count:t.cart().numberOfItems(),formattedCount:i,currency:s,totalPrice:e}),n},t),$("body").mouseover(function(){$("[cclink-url]:not(.click-bound)").length>0&&$("[cclink-url]:not(.click-bound)").addClass("click-bound").on("click",function(){var e=$(this).attr("cclink-url");s.goTo(e);if(e.indexOf("#")!==-1){var t=e.split("#")[1];if(t&&t!=="")var n=10,r=setInterval(function(){console.log("Waiting for anchor"),$("a[href='#"+t+"']").length>0||n<0?($(document).scrollTop($("#"+t).offset().top),clearInterval(r)):n--},1e3)}})})},synchronizeSession:function(){var e=this,t=e.user().client().loggedIn;if(t){var n=window.sessionStorage.getItem("noLoggedInItems");n=n&&n!==""?JSON.parse(n):[],n=h.uniq(n),n.length>0?setTimeout(function(){n=g(e,n,e.cart().items()),e.cart().emptyCart(),e.cart().markDirty(),setTimeout(function(){v(e,n,function(){console.log("All ITEMS ADDED")})},1e3)},1e3):window.sessionStorage.removeItem("noLoggedInItems")}},renderWidget:e.observable(!1),beforeAppear:function(e){$("html,body").scrollTop(0),u("body").css("overflow","visible"),$("div.mmenuH, .rTopIcons.rrr > a, .resSearchSmall").unbind("click"),$("div.mmenuH, .rTopIcons.rrr > a, .resSearchSmall").unbind("touchend"),window.localStorage.setItem("currentPageURL",window.location.href),Global.loadCSS(d);var t="/midtier/js/maxymiser.js";(function(e,n){var r=e.createElement(n),i=e.getElementsByTagName(n)[0];r.src=t,r.async=!0,i.parentNode.insertBefore(r,i)})(document,"script"),$(".glyphicon-shopping-cart").css("color","#ffffff");var n=this;console.log("********** beforeAppear Page ********"),console.log(e),console.log("********** beforeAppear Wid ********"),console.log(n),console.log("********** beforeAppear End ********"),n.renderWidget(!1),n.renderWidget(!0),n.loadDesignJavascript(),n.closeMMainMenu();var r;window.localStorage.getItem("occs_user_content_locale-storefrontUI")!==null?r=JSON.parse(window.localStorage.getItem("occs_user_content_locale-storefrontUI"))[0].displayName:r="English",n.languageLinkText(r);var i=p[n.site().selectedPriceListGroup().repositoryId].countryCode;i=i.toLowerCase(),n.myFlag("flag-"+i),n.showCountrySelectMessage(i),n.loggedInstatus(n.user().loggedIn()),n.user().loggedIn()?n.locale()=="ja"?n.loggedInUserName(n.user().lastName()+" "+n.user().firstName()+" "+"様"):n.locale()=="ko"?n.loggedInUserName(n.user().lastName()+" "+n.user().firstName()+" "+"님, 환영합니다"):(n.helloMsg(n.translate("hello")+", "),n.loggedInUserName(n.user().loggedInUserName())):n.helloMsg(n.translate("hello")+". "),window.sessionStorage.getItem("objectCountryCode")===null&&window.sessionStorage.setItem("objectCountryCode",i),window.sessionStorage.getItem("objectCountryCode")!==i&&(window.localStorage.setItem("userSetCountry","true"),$(".selectCountrymessage").remove()),n.setReqTrainingLink()},keypressHandler:function(e,t){var n,r,s;n=this,r=u(t.target),s=t.which?t.which:t.keyCode,t.shiftKey&&s==i.KEY_CODE_TAB&&(s=i.KEY_CODE_SHIFT_TAB);switch(s){case i.KEY_CODE_TAB:r[0].id!=="CC-header-cart-total"&&u("#dropdowncart").removeClass("active");break;case i.KEY_CODE_SHIFT_TAB:r[0].id==="CC-header-cart-total"&&u("#dropdowncart").removeClass("active")}return!0},showCountrySelectMessage:function(e){$(".selectCountrymessage").hide(),window.localStorage.getItem("userSetCountry")===null&&($(".selectCountrymessage").show(),$(".closeCountrymessage").on("click",function(e){window.localStorage.setItem("userSetCountry","true"),$(".selectCountrymessage").remove()}))},showDropDownCart:function(){this.cartOpenTimeout&&clearTimeout(this.cartOpenTimeout),this.cartVisible(!0),n.emptyGrowlMessages(),this.computeDropdowncartHeight(),this["header-ou-minicart"].currentSection(1),this.computeMiniCartItems(),u("#dropdowncart").addClass("active"),u("#dropdowncart > .content").fadeIn("slow"),u(document).on("mouseleave","#dropdowncart",function(){u("#dropdowncart > .content").fadeOut("slow"),u(this).removeClass("active")});var e=navigator.userAgent.match(i.IPAD_STRING)!=null;e&&u(document).on("touchend",function(e){return u(e.target).closest("#dropdowncart").length||(u("#dropdowncart > .content").fadeOut("slow"),u("#dropdowncart").removeClass("active")),u(e.target).closest("#CC-megaMenu").length&&u(window).width()>=i.VIEWPORT_TABLET_UPPER_WIDTH?(u(document).off("touchend"),!1):!0})},hideDropDownCart:function(){return this.cartVisible(!1),u("#dropdowncart > .content").fadeOut("slow"),u("#dropdowncart").removeClass("active"),this.cartOpenTimeout&&clearTimeout(this.cartOpenTimeout),!0},toggleDropDownCart:function(){u("#dropdowncart").hasClass("active")?this.hideDropDownCart():this.showDropDownCart()},handleRemoveFromCart:function(){u.Topic(t.topicNames.CART_REMOVE).publishWith(this.productData(),[{message:"success"}])},handleValidateCart:function(e,n){if(e.user().isUserProfileEdited())return!0;e.cart().validatePrice=!0,s.getRelativePath()==e.links().cart.route&&e.cart().skipPriceChange(!0),u.Topic(t.topicNames.LOAD_CHECKOUT).publishWith(e.cart(),[{message:"success"}])},handleDropDownCheckout:function(e,t){this.hideDropDownCart(),this.handleValidateCart(e,t)},skipToContentHandler:function(){var e=u("#region-navbar").attr("id");if(!e){e=u("#region-megaMenu").next().attr("id");if(typeof e=="undefined"||e===null)e=u("#region-header").next().attr("id")}else e=u("#region-navbar").next().attr("id");var t="#"+e+" :focusable";u(t).first().focus()},processNrParameter:function(e,t){if(e.indexOf("(")===-1)return e;var n=e.split("(")[1],r=n.split(")")[0],i=r.split(","),s="";for(var o=0;o<i.length;o++){if(i[o].indexOf("product.priceListPair")!==-1&&t==="currency-picker")continue;if(i[o].indexOf("product.language")!==-1&&t==="language-picker")continue;s===""?s=i[o]:s=s+","+i[o]}return s=e.split("(")[0]+"("+s,s=s+")"+e.split(")")[1],s},miniCartNumberOfItems:function(){},loadDesignJavascript:function(){var e=this,t=u(window).height();u("div.top-level .menuPad").css("height",t-133),u(".rCountry .resCountry .rScroller, .rLanguage .resLanguage .rScroller").css("height",t-223),u("#mAutoitems").css("height",t-113),u(window).resize(function(){t=u(window).height(),u("div.top-level .menuPad").css("height",t-133),u(".rCountry .resCountry .rScroller, .rLanguage .resLanguage .rScroller").css("height",t-223),u("#mAutoitems").css("height",t-113)});var n=document.ontouchstart!==null?"click":"click touchend";u("div.groupHead").bind(n,function(e){n!="click"&&e.preventDefault();var t=u(this).attr("class").split(" ")[1];u(".top-level, .groupHead, .submenu2, .submenu3").removeClass("active"),u(".columns").removeClass("inactive"),u("#"+t).addClass("active"),u(this).addClass("active"),u("li").removeClass("hideLi"),u("div.columns").removeClass("inactive"),u("#"+t+" .menuPad").scrollTop(0)}),u(".right1").bind(n,function(e){n!="click"&&e.preventDefault(),u(this).parent().children(".submenu2").addClass("active"),u(this).parents(".top-level").find("div.columns:not(#mosaicHead_pillar)").addClass("inactive"),u(".submenu3").removeClass("active"),u(this).parent().parent().children("li").addClass("hideLi"),u(".menuPad").scrollTop(0)}),u(".left1").bind(n,function(e){n!="click"&&e.preventDefault(),u(this).parents(".submenu2").removeClass("active"),u("div.columns").removeClass("inactive"),u(this).parents("#mosaicHead_pillar").find("li").removeClass("hideLi")}),u(".right2").bind(n,function(e){n!="click"&&e.preventDefault(),u(this).parent().children(".submenu3").addClass("active"),u(this).parent().parent().children("li").addClass("hideLi"),u(".menuPad").scrollTop(0)}),u(".left2").bind(n,function(e){n!="click"&&e.preventDefault(),u(this).parents(".submenu3").removeClass("active"),u(this).parents(".submenu2").find("li").removeClass("hideLi")}),u(".groupHead a").attr("href","JavaScript:void(0);"),n!="click"?(u("div.top-level .menuPad").css("margin-right","0"),u("#searchForm2 .autoComp").keyup(function(e){var e=window.event||e,t=e.charCode||e.keyCode;u(".autoComp.acActive").val().length<1&&u(".closeMenu").removeClass("active"),t!=13&&t!=27&&!(t>=16&&t<=18)&&!(t>=32&&t<=40)&&u(".closeMenu").addClass("active")})):u("div.top-level .menuPad, #mAutoitems").css("margin-right","-17px"),u(".closeMenu").bind(n,function(e){n!="click"&&e.preventDefault(),u(".autoComp.acActive").val(""),u("#mAutoitems").css("display","none"),u(".closeMenu").removeClass("active")});if("createTouch"in document&&e.mobilecheck())try{var r=/:hover\b/;for(var i=0;i<document.styleSheets.length;i++){var s=document.styleSheets[i];for(var o=s.cssRules.length-1;o>=0;o--){var a=s.cssRules[o];a.type===CSSRule.STYLE_RULE&&r.test(a.selectorText)&&s.deleteRule(o)}}}catch(f){}var l=0;u(document).ready(function(){u("div.mmenuH").hasClass("active")||u("div.mmenuH").bind(n,function(t){t.preventDefault(),u(".groupHeadContent, #mmenuData .top-level").css({display:"block"}),u(".rTopIcons, .resSearch, .resSearchSmall").removeClass("active"),u(this).hasClass("active")?(u("body").css("overflow","visible"),e.closeMMainMenu()):(u("body").css("overflow","hidden"),e.openMMainMenu())}),u(".rTopIcons.rrr > a").unbind(n),u(".rTopIcons.rrr > a").bind(n,function(e){e.preventDefault();var t=u(this).parent();t.hasClass("active")?(t.removeClass("active"),u(".groupHeadContent, #mmenuData .top-level").css({display:"block"})):(u(".rTopIcons.rrr").removeClass("active"),u(".groupHeadContent, #mmenuData .top-level").css({display:"none"}),t.addClass("active"))}),u(".resSearchSmall").bind(n,function(e){e.preventDefault(),u("body").css("overflow","visible"),u("div.mmenuH, .responseMenu, .responseMenu .top-level").removeClass("open active"),u(".resSearchSmall").hasClass("active")?u(".resSearch, .resSearchSmall").removeClass("active"):u(".resSearch, .resSearchSmall").addClass("active")})})},openMMainMenu:function(){u("#mmenuData").addClass("active"),u("#mmenuData .groupHead.g1").addClass("active"),u("#mmenuData .top-level#g1").addClass("active"),u(".mmenuH").addClass("open").addClass("active")},closeMMainMenu:function(){u("#mmenuData").removeClass("active"),u("#mmenuData .groupHead.g1").removeClass("active"),u("#mmenuData .top-level#g1").removeClass("active"),u(".mmenuH").removeClass("open").removeClass("active")},mobilecheck:function(){var e=!1;(function(t){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))e=!0})(navigator.userAgent||navigator.vendor||window.opera);var t=navigator.userAgent.match(/iPad/i)!=null,n=window.navigator.userAgent.toLowerCase(),r=/iphone|ipod|ipad/.test(n);return e||t||r},setReqTrainingLink:function(){var e=this,t,n="",r="";e.site().selectedPriceListGroup()?t=e.site().selectedPriceListGroup().id:t=e.site().priceListGroup.defaultPriceListGroup.id,$.getJSON("/midtier/json/countriesOrgId.json",function(i){i[t]&&i[t].orgId!==null&&typeof i[t].orgId!="undefined"&&(n=i[t].orgId),i[t]&&i[t].lang!==null&&typeof i[t].lang!="undefined"&&(r=i[t].lang),n===""||r===""?e.linkReqTraining("http://learn.oracle.com/pls/web_prod-plq-dad/db_pages.getdcpage?page_id=399"):e.linkReqTraining("http://learn.oracle.com/pls/web_prod-plq-dad/db_pages.getdcpage?page_id=399&p_org_id="+n+"&lang="+r)})}}})