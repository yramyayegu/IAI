define(["pageLayout/cart","knockout","pubsub","notifier","notifications","storeKoExtensions","CCi18n","ccNumber","jquery","ccConstants","navigation","storageApi","pageLayout/site","viewModels/dynamicProperty","ccRestClient","viewModels/address","koMapping","ccStoreConfiguration","viewModels/cart-item","viewModels/shipping-group-relationship","viewModels/cart-item-external-data","currencyHelper"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){"use strict";return{onLoad:function(){function t(e){this.shoppingCart=new Object,this.shoppingCart.items=e.items(),this.shoppingCart.coupons=e.coupons(),!e.mergeCart()&&e.currentOrderId()&&(this.id=e.currentOrderId()),e.giftWithPurchaseOrderMarkers&&e.giftWithPurchaseOrderMarkers.length&&(this.giftWithPurchaseOrderMarkers=e.giftWithPurchaseOrderMarkers),this.combineLineItems=e.combineLineItems,this.payments=[],e.populateDynamicProperties(this)}e.prototype.createCurrentProfileOrder=function(){var e=this,i={incomplete:!0};if(e.items()&&e.items().length>0&&!e.isOrderSubmissionInProgress){var s=e.events.pop(),u=new t(e);e.populateGiftCards(u,s),e.populateIINs(u,s),e.adapter.persistCreate("order","0",u,i,function(t){e.isPricingRequired(!1),e.shippingMethod()?(e.updateCart(t,s,!1),e.skipGWPMessage=!0,e.populateShipppingMethods()):e.updateCart(t,s,!1,!0),a.Topic(n.topicNames.COUPON_ADD_CLEAR_INPUT).publish(),e.callbacks&&e.callbacks.hasOwnProperty(f.PRICING_SUCCESS_CB)&&typeof e.callbacks[f.PRICING_SUCCESS_CB]=="function"&&e.callbacks[f.PRICING_SUCCESS_CB](t)},function(t){if(t.status==f.HTTP_UNAUTHORIZED_ERROR)e.handleSessionExpiry(s);else{if(t.errorCode==f.COUPON_APPLY_ERROR)e.handleCouponPricingError(t,s);else if(t.errorCode==f.GIFTCARD_APPLY_ERROR||t.errorCode==f.GIFTCARD_INSUFFICIENT_ERROR||t.errorCode==f.INVALID_GIFTCARD_DATA_ERROR||t.errorCode==f.GIFTCARD_ORDER_PROCESSING_ERROR)e.handleGiftCardError(t);else if(t.errorCode==f.CREATE_ORDER_PRODUCT_NOT_FOUND||t.errorCode==f.CREATE_ORDER_SKU_NOT_FOUND||t.errorCode==f.PRODUCT_NOT_FOR_INDIVIDUAL_SALE)e.handleInvalidAddItem(t,s),e.notifyInvalidProducts();else if(t.errorCode==f.UNLINKED_ADD_ON_PRODUCT){if(s&&s.type==CART_EVENT_ADD&&s.product.selectedAddOnProducts){var n=JSON.parse(t.moreInfo);e.handleInvalidAddonItem(s.product.selectedAddOnProducts,n.productId,n.catRefId),e.notifyInvalidProducts()}}else if(t.errorCode==f.ADDON_VOLUME_PRICE_ERROR){var i=t.message+" "+o.t("ns.common:resources.removeItemFromCart");r.sendError(CART_VIEW_MODEL_ID,i,!0),e.isDirty(!1)}else if(t.errorCode==f.INVALID_SHOPPER_INPUT){var n=JSON.parse(t.moreInfo),u=n.productId,a=e.findCartProductById(u);a&&(u=a.displayName);var i=o.t("ns.common:resources.invalidShopperInputError",{productName:u});r.sendError(CART_VIEW_MODEL_ID,i,!0),e.isDirty(!1)}e.loadCart()}e.callbacks&&e.callbacks.hasOwnProperty(f.PRICING_FAILURE_CB)&&typeof e.callbacks[f.PRICING_FAILURE_CB]=="function"&&e.callbacks[f.PRICING_FAILURE_CB](t)})}else e.isOrderSubmissionInProgress&&console.warn(o.t("ns.common:resources.priceOrderBlockedText"))}}}})