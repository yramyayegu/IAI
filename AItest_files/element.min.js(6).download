define(["jquery","knockout","ccConstants","ccRestClient","notifications","pubsub","storageApi","navigation","/midtier/js/priceGroupCountry.js"],function(e,t,n,r,i,s,o,u,a){"use strict";var f=["Bangladesh_Dollar","Nepal_Dollar","Srilanka_Dollar","Afghanisthan_rupee","Bhutan_rupee","Belize_rupee","Cambodia_rupee","Honduras_rupee","Laos_rupee","Maldives_rupee","Myanmar_rupee","Nicaragua_rupee"],l={};return{elementName:"header-ou-currency-picker",defaultPriceListGroup:t.observable(),activePriceListGroups:t.observableArray([]),currencyDropdownVisible:t.observable(!1),onLoad:function(t){var n=this;n.loadPicker(t.site()),n.handleCurrencyChange=function(r){var i=this;if(e.inArray(i.displayName,f)>-1)u.goTo("/OUcontactUs");else{var s=t.site().selectedPriceListGroup();t.cart().emptyCart(),t.cart().markDirty(),n.storePriceListGroupInLocalStorage(i),n.activePriceListGroups()[r]=s,n.sortCurrencies();if(u.getRelativePath().indexOf(t.links().searchresults.route)!==-1){var o=decodeURIComponent(window.location.search);o=o.replace("?","");var a=o.split("&"),l="";for(var c=0;c<a.length;c++)a[c].split("=")[0]==="Nr"?l===""?l="Nr="+t.processNrParameter(a[c].split("=")[1],"currency-picker"):l=l+"&"+"Nr="+t.processNrParameter(a[c].split("=")[1],"currency-picker"):l===""?l=a[c]:l=l+"&"+a[c];var h=u.getBaseURL()+"/"+u.getPath()+"?"+l;window.location.assign(h)}else window.location.reload()}},t.site().activePriceListGroups.subscribe(function(e){n.loadPicker(t.site())})},loadPicker:function(e){var t=this;if(e.priceListGroup.defaultPriceListGroup){t.defaultPriceListGroup(null);try{e.priceListGroup.defaultPriceListGroup.newName=priceGroupCountryName[0][e.priceListGroup.defaultPriceListGroup.id].name}catch(i){e.priceListGroup.defaultPriceListGroup.newName=e.priceListGroup.defaultPriceListGroup.id}t.defaultPriceListGroup(e.priceListGroup.defaultPriceListGroup)}if(e.priceListGroup.activePriceListGroups.length){t.activePriceListGroups.removeAll();for(var s=0;s<e.priceListGroup.activePriceListGroups.length;s++){try{e.priceListGroup.activePriceListGroups[s].newName=priceGroupCountryName[0][e.priceListGroup.activePriceListGroups[s].id].name}catch(i){e.priceListGroup.activePriceListGroups[s].newName=e.priceListGroup.activePriceListGroups[s].id}t.activePriceListGroups.push(e.priceListGroup.activePriceListGroups[s])}for(var o in l)t.activePriceListGroups.push(l[o])}var u=JSON.parse(r.getStoredValue(n.LOCAL_STORAGE_CURRENCY)),a=JSON.parse(r.getStoredValue(n.LOCAL_STORAGE_PRICELISTGROUP_ID));if(!u&&t.defaultPriceListGroup())e.selectedPriceListGroup(t.defaultPriceListGroup()),t.storePriceListGroupInLocalStorage(t.defaultPriceListGroup());else{var f=!1;for(var s=0;s<t.activePriceListGroups().length;s++)if(u.repositoryId===t.activePriceListGroups()[s].currency.repositoryId&&a==t.activePriceListGroups()[s].id){e.selectedPriceListGroup(t.activePriceListGroups()[s]),t.storePriceListGroupInLocalStorage(t.activePriceListGroups()[s]),f=!0;break}!f&&t.defaultPriceListGroup()&&(e.selectedPriceListGroup(t.defaultPriceListGroup()),t.storePriceListGroupInLocalStorage(t.defaultPriceListGroup()))}var c=e.selectedPriceListGroup().id;for(var s=0;s<t.activePriceListGroups().length;s++)t.activePriceListGroups()[s].id===c&&t.activePriceListGroups.splice(s,1);t.sortCurrencies()},sortCurrencies:function(){var e=this;e.activePriceListGroups.sort(function(e,t){return e.newName==t.newName?0:e.newName<t.newName?-1:1})},storePriceListGroupInLocalStorage:function(e){var i=this;r.setStoredValue(n.LOCAL_STORAGE_CURRENCY,t.toJSON(e.currency)),r.setStoredValue(n.LOCAL_STORAGE_PRICELISTGROUP_ID,t.toJSON(e.id))}}})