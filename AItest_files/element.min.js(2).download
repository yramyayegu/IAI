define(["jquery","knockout","pubsub","notifications","ccConstants","/midtier/js/OUTypeAhead.js","placeholderPatch","navigation"],function(e,t,n,r,i,s,o,u){"use strict";var a="ounewsearch";return{elementName:a,searchText:t.observable(""),SEARCH_SELECTOR:".search-query",handleKeyPress:function(t,n){if(t.user().isUserProfileEdited())return e("#CC-customerProfile-modal").modal("show"),t.user().isSearchInitiatedWithUnsavedChanges(!0),!1;var r;r=n.which?n.which:n.keyCode;switch(r){case i.KEY_CODE_ENTER:return this.elements[a].handleSearch(t,n),e("input#CC-headerWidget-Search-Mobile").blur(),!1}return!0},handleSearch:function(t,r){e.Topic(n.topicNames.SEARCH_TYPEAHEAD_CANCEL).publish([{message:"success"}]);var s=e.trim(this.searchText());s.length!=0&&(u.goTo("/searchresults?"+i.SEARCH_NAV_RECORD_FILTER_KEY+"="+encodeURIComponent(i.PRODUCT_DISPLAYABLE_PROPERTY+i.SEARCH_COLON_SEPERATOR+i.PRODUCT_DISPLAYABLE)+"&"+i.SEARCH_TERM_KEY+"="+encodeURIComponent(this.searchText().trim())+"&"+i.SEARCH_DYM_SPELL_CORRECTION_KEY+"="+encodeURIComponent(i.DYM_ENABLED)+"&"+i.SEARCH_NAV_ERECS_OFFSET+"=0&"+i.SEARCH_REC_PER_PAGE_KEY+"="+i.DEFAULT_SEARCH_RECORDS_PER_PAGE+"&"+i.SEARCH_RANDOM_KEY+"="+Math.floor(Math.random()*1e3)+"&"+i.SEARCH_TYPE+"="+i.SEARCH_TYPE_SIMPLE+"&"+i.PARAMETERS_TYPE+"="+i.PARAMETERS_SEARCH_QUERY),this.searchText(""))},initializeSearch:function(){this.elements[a].initTypeahead.bind(this)(),this.elements[a].addPlaceholder()},initTypeahead:function(){var e=s.getInstance(this.elements[a].SEARCH_SELECTOR,this.site().selectedPriceListGroup().currency);r.emptyGrowlMessages()},addPlaceholder:function(){e("#CC-headerWidget-Search-Desktop").placeholder(),e("#CC-headerWidget-Search-Mobile").placeholder()},searchSelected:function(){r.emptyGrowlMessages(),e.Topic(n.topicNames.OVERLAYED_GUIDEDNAVIGATION_HIDE).publish([{message:"success"}])},hideSearchDropdown:function(t,n){var r=n.which?n.which:n.keyCode;if(r!==i.KEY_CODE_ENTER)return!0;e("#typeaheadDropdown").hide()}}})