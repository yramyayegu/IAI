define(["knockout","jquery","jqueryui","ccConstants","ccRestClient","CCi18n","bootstrap","navigation","pubsub","/midtier/js/priceGroupCountry.js","/midtier/js/text.js!/midtier/json/allCategories.json"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";f=priceGroupCountryName[0],l=JSON.parse(l);var c=["pPillar_642","pPillar_643","pPillar_644","pPillar_645","pPillar_646"];return{elementName:"mainMenu",trainingHierachy:e.observable(""),certificationHierachy:e.observable(""),urlLocale:e.observable(),staticStructure:e.observable(),site2Load:e.observable(),cloudCategories:e.observableArray(["pPillar_640","pPillar_641","pPillar_642","pPillar_643","pPillar_644","pPillar_645","pPillar_646"]),onLoad:function(e){var n=this,r=e.site().siteInfo.id;n.site2Load(r),n.getCollectionSuccessCallback(e,r,l),t.ajax({url:"/midtier/json/staticHeadContent_"+r+".json",contentType:"application/json; charset=utf-8",dataType:"json",success:function(r){console.log("Loaded Cached Static Menu Content"),r=n.applyFiltersByCountry(r,e.site().selectedPriceListGroup().id);for(var i in r){r[i].offSetArr=[];if(r[i].colOffSet){var s=r[i].colOffSet;while(s>0)r[i].offSetArr.push({}),s--}}t(".responseMenu").css("display")==="block"?e.loadMainMenuStructure(r,"static"):(n.staticStructure(r),setTimeout(function(){n.runMenuJQueryValidations(),n.setMenuDissapearOnLink()},400))}})},isCloudCategory:function(e){var t=!1;for(var n=0;n<this.cloudCategories().length;n++)if(this.cloudCategories()[n]==e){t=!0;break}return t},getCollectionSuccessCallback:function(e,n,r){var i=this;window.sessionStorage.setItem("loadedCatsTree",JSON.stringify(r));var s=this.cleanupCollectionTree(r,"TRAINING"),o=this.cleanupCollectionTree(r,"CERTIFICATIONS"),u=this.fetchLocale("lcl");t(".responseMenu").css("display")==="block"?e.loadMainMenuStructure({training:s,certification:o},"dynamic"):(this.trainingHierachy(s),this.certificationHierachy(o),this.urlLocale(u))},runMenuJQueryValidations:function(){var e=this,n=e.staticStructure();for(var r in n){var i=r+"Section";n[r].smallContainer&&(t("#"+i+" .navContainer").addClass("navContainerSmall").removeClass("navContainer"),t("#"+i+" .navContainerSmall").css({width:"350px",left:"unset"}),t("#"+i+" .navContainerSmall .column").addClass("noborder")),n[r].mediumContainer&&(t("#"+i+" .navContainer").addClass("navContainerSmall navContainerMedium").removeClass("navContainer"),t("#"+i+" .navContainerSmall").css({width:"486px",left:"unset"}),t("#"+i+" .navContainerSmall.navContainerMedium .column:last").addClass("noborder"))}},setMenuDissapearOnLink:function(){t("ul.nav-mainmenu").children("li").each(function(){var e=t(this);e.children("a").mouseover(function(){e.removeClass("nohover"),t("a",e).click(function(){e.addClass("nohover")})})})},cleanupCollectionTree:function(e,n){var r=jQuery.extend(!0,{},e);return jQuery.each(r.childCategories,function(e,r){var i=!1;t.inArray(r.id,c)>-1&&(i=!0),r.childCategories!=undefined&&jQuery.each(r.childCategories,function(e,t){t.childCategories!=undefined&&jQuery.each(t.childCategories,function(e,s){var o=!1;s.childCategories!=undefined&&jQuery.each(s.childCategories,function(e,t){if(t.displayName!==null){if(t.displayName.trim()===n||t.displayName.trim()==="LEARNING SUBSCRIPTIONS"||t.displayName.trim()==="LEARNING PATHS")o=!0}else console.log("subcat error with "+t.id)}),o==1&&(s.display=!0,t.display=!0,r.display=!0,i===!0?r.containsSaas=!0:r.containsSaas=!1)})})}),r},getCollectionErrorCallback:function(e){console.log(e)},createURL:function(e,t){var n=e+"?pageReq="+t;location.href=n},createProductPageURL:function(e,t){var n="en",r=window.location.pathname;r!=null&&r!=""&&(n=r.split("/")[1]);if(n==null||n=="")n="en";var i="/"+n+"/products?pageReq="+t+"&id="+e;location.href=i},createCertificationURL:function(e,t){var n="en",r=window.location.pathname;r!=null&&r!=""&&(n=r.split("/")[1]);if(n==null||n=="")n="en";var i="/"+n+"/products?pageReq="+t+"&id="+e+"&certPage=true";location.href=i},createCertProductPageURL:function(e,t){var n=e+"?pageReq="+t;location.href=n},fetchLocale:function(e){var t="en",n=window.location.pathname;n!=null&&n!=""&&(t=n.split("/")[1]);if(t==null||t=="")t="en";return t},applyFiltersByCountry:function(e,t){for(var n in e){var r=e[n];for(var i in r.columns){var s=r.columns[i];for(var o in s.items){var u=s.items[o];u.type==="link"&&u[t+"_href"]&&(e[n].columns[i].items[o].href=u[t+"_href"]),u.hidden_for&&u.hidden_for.indexOf(t)!==-1&&(e[n].columns[i].items[o].hidden=!0);if(u.terms){var a=f[t].countryCode;e[n].columns[i].items[o].href=e[n].columns[i].items[o].href.replace("__COUNTRY__",a)}u.type==="link"&&/(http\:\/\/|https\:\/\/)/ig.test(u.href)&&(e[n].columns[i].items[o].target="_blank")}}}return e}}})